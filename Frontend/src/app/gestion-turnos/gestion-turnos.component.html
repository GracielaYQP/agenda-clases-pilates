<div class="table-container" *ngIf="horarios.length > 0">
  <h2>Gesti√≥n de Turnos</h2>
  <table>
    <thead>
      <tr>
        <th>Horario</th>
        <th *ngFor="let dia of dias">{{ dia }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let hora of horas">
        <td class="hora-columna">{{ hora }}</td>
        <td *ngFor="let dia of dias">
          <!-- Bloqueo espec√≠fico para Viernes 8:00 y 19:00 -->
          <ng-container *ngIf="!(dia === 'Viernes' && (hora === '08:00' || hora === '18:00')); else bloqueado">
            <ng-container *ngIf="hasTurno(dia, hora); else sinTurno">
              <ng-container *ngFor="let turno of getTurnos(dia, hora)">
                <div
                  class="clickeable {{ turno.nivel.toLowerCase() }}"
                  (click)="abrirTurno(turno)">
                  <div class="nivel">{{ turno.nivel }}</div>
                  <div class="camas">Camas libres: {{ turno.totalCamas - turno.camasReservadas }}</div>
                  <div class="reservas" *ngIf="turno.reservas && turno.reservas.length > 0">
                    <div *ngFor="let r of turno.reservas">
                      <!-- Mostrar nombre y apellido si sos admin o si el turno coincide con tu nivel -->
                      <ng-container *ngIf="rolUsuario === 'admin' || turno.nivel.toLowerCase() === usuarioNivel.toLowerCase()">
                        {{ r.nombre }} {{ r.apellido }}
                      </ng-container>
                    </div>
                  </div>
                </div>
              </ng-container>
            </ng-container>
          </ng-container>

          <ng-template #sinTurno>
            <div class="no-disponible"> -- </div>
          </ng-template>

          <ng-template #bloqueado>
            <div class="no-disponible">No disponible</div>
          </ng-template>
        </td>
      </tr>
    </tbody>
  </table>
</div>
<!-- ‚úÖ MODAL PARA ADMIN -->
<div *ngIf="modalAbierto" class="modal-overlay">
  <div class="modal-content">
    <h3>Editar Turno: {{ turnoSeleccionado.dia }} - {{ turnoSeleccionado.hora }}</h3>
    <p>Nivel: {{ turnoSeleccionado.nivel }}</p>

    <div *ngIf="turnoSeleccionado.reservas?.length > 0">
      <h4>Reservas actuales:</h4>

      <ul>
        <ng-container *ngFor="let r of turnoSeleccionado.reservas">
          <li *ngIf="reservaEditandoId !== r.id">
            {{ r.nombre }} {{ r.apellido }}
            <button class="btn-anular" (click)="anularReserva(r.id)">Anular</button>
            <button class="btn-editar" (click)="iniciarEdicionReserva(r)">üìù Editar</button>
          </li>

          <li *ngIf="reservaEditandoId === r.id" class="reserva-editando">
            <input [(ngModel)]="nombreEditado" placeholder="Nombre" />
            <input [(ngModel)]="apellidoEditado" placeholder="Apellido" />
            <input [(ngModel)]="nuevoUserId" type="number" placeholder="Nuevo userId (opcional)" />
            <button (click)="guardarEdicionReserva()">üíæ Guardar</button>
            <button (click)="reservaEditandoId = null">‚ùå Cancelar</button>
          </li>
        </ng-container>
      </ul>
    </div>

    <div *ngIf="turnoSeleccionado.reservas?.length === 0">
      <p>No hay reservas a√∫n en este turno.</p>
    </div>

    <!-- üîΩ FORMULARIO PARA AGREGAR NUEVA RESERVA -->
    <hr>
    <button (click)="mostrarFormAgregar = !mostrarFormAgregar"
      [ngClass]="mostrarFormAgregar ? 'btn-cancelar-toggle' : 'btn-agregar-toggle'">
      {{ mostrarFormAgregar ? 'Cancelar' : '+ Agregar reserva para otro usuario' }}
    </button>

    <div *ngIf="mostrarFormAgregar" class="form-agregar">
      <label for="modoBusqueda">Buscar usuario por:</label>
      <select id="modoBusqueda" [(ngModel)]="busquedaModo">
        <option value="nombre-apellido">Nombre y Apellido</option>
        <option value="telefono">Tel√©fono</option>
      </select>

      <!-- Campos din√°micos -->
      <div *ngIf="busquedaModo === 'nombre-apellido'">
        <input type="text" [(ngModel)]="nombreNuevo" placeholder="Nombre" />
        <input type="text" [(ngModel)]="apellidoNuevo" placeholder="Apellido" />
      </div>

      <div *ngIf="busquedaModo === 'telefono'">
        <input type="text" [(ngModel)]="telefonoNuevo" placeholder="Tel√©fono" />
      </div>

      <button (click)="agregarReserva(turnoSeleccionado.id)" class="btn-confirmar">Confirmar</button>
    </div>

    <!-- Bot√≥n para cerrar -->
    <button class="btn-cerrar" (click)="cerrarModal()" class="btn-cerrar">Cerrar</button>
  </div>
</div>
<!-- ‚úÖ MODAL  PARA ALUMNO -->
<div *ngIf="modalAlumnoAbierto" class="modal-overlay">
  <div class="modal-content">
    <h3>Confirmar Reserva</h3>
    <p><strong>Nombre:</strong> {{ nombreUsuario }}</p>
    <p><strong>Apellido:</strong> {{ apellidoUsuario }}</p>
    <p><strong>D√≠a:</strong> {{ turnoSeleccionado?.dia }}</p>
    <p><strong>Hora:</strong> {{ turnoSeleccionado?.hora }}</p>
    <p><strong>Nivel:</strong> {{ turnoSeleccionado?.nivel }}</p>

    <button class="btn-confirmar" (click)="confirmarReserva()">‚úÖ Confirmar</button>
    <button class="btn-cerrar" (click)="cerrarModalAlumno()">Cancelar</button>
  </div>
</div>



